{"ast":null,"code":"var _interopRequireDefault=require(\"@babel/runtime/helpers/interopRequireDefault\");Object.defineProperty(exports,\"__esModule\",{value:true});exports.default=void 0;var _defineProperty2=_interopRequireDefault(require(\"@babel/runtime/helpers/defineProperty\"));var _objectWithoutProperties2=_interopRequireDefault(require(\"@babel/runtime/helpers/objectWithoutProperties\"));var _classCallCheck2=_interopRequireDefault(require(\"@babel/runtime/helpers/classCallCheck\"));var _createClass2=_interopRequireDefault(require(\"@babel/runtime/helpers/createClass\"));var _agent=_interopRequireDefault(require(\"./agent\"));var _reactNative=require(\"react-native\");var _url=_interopRequireDefault(require(\"url\"));var _authError=_interopRequireDefault(require(\"../auth/authError\"));var _jwt=_interopRequireDefault(require(\"../jwt\"));function ownKeys(object,enumerableOnly){var keys=Object.keys(object);if(Object.getOwnPropertySymbols){var symbols=Object.getOwnPropertySymbols(object);if(enumerableOnly)symbols=symbols.filter(function(sym){return Object.getOwnPropertyDescriptor(object,sym).enumerable;});keys.push.apply(keys,symbols);}return keys;}function _objectSpread(target){for(var i=1;i<arguments.length;i++){var source=arguments[i]!=null?arguments[i]:{};if(i%2){ownKeys(Object(source),true).forEach(function(key){(0,_defineProperty2.default)(target,key,source[key]);});}else if(Object.getOwnPropertyDescriptors){Object.defineProperties(target,Object.getOwnPropertyDescriptors(source));}else{ownKeys(Object(source)).forEach(function(key){Object.defineProperty(target,key,Object.getOwnPropertyDescriptor(source,key));});}}return target;}var A0Auth0=_reactNative.NativeModules.A0Auth0;var callbackUri=function callbackUri(domain){var bundleIdentifier=A0Auth0.bundleIdentifier;var lowerCasedIdentifier=bundleIdentifier.toLowerCase();if(bundleIdentifier!==lowerCasedIdentifier){console.warn('The Bundle Identifier or Application ID of your app contains uppercase characters and will be lowercased to build the Callback URL. Check the Auth0 dashboard to whitelist the right URL value.');}return lowerCasedIdentifier+\"://\"+domain+\"/\"+_reactNative.Platform.OS+\"/\"+bundleIdentifier+\"/callback\";};var WebAuth=function(){function WebAuth(auth){(0,_classCallCheck2.default)(this,WebAuth);this.client=auth;var baseUrl=auth.baseUrl,clientId=auth.clientId,domain=auth.domain;this.domain=domain;this.clientId=clientId;this.agent=new _agent.default();}(0,_createClass2.default)(WebAuth,[{key:\"authorize\",value:function authorize(){var _this=this;var parameters=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var options=arguments.length>1&&arguments[1]!==undefined?arguments[1]:{};var clientId=this.clientId,domain=this.domain,client=this.client,agent=this.agent;return agent.newTransaction().then(function(_ref){var state=_ref.state,verifier=_ref.verifier,defaults=(0,_objectWithoutProperties2.default)(_ref,[\"state\",\"verifier\"]);var redirectUri=callbackUri(domain);var expectedState=parameters.state||state;var query=_objectSpread(_objectSpread({},defaults),{},{clientId:clientId,responseType:'code',redirectUri:redirectUri,state:expectedState},parameters);var authorizeUrl=_this.client.authorizeUrl(query);return agent.show(authorizeUrl,options.ephemeralSession).then(function(redirectUrl){if(!redirectUrl||!redirectUrl.startsWith(redirectUri)){throw new _authError.default({json:{error:'a0.redirect_uri.not_expected',error_description:\"Expected \"+redirectUri+\" but got \"+redirectUrl},status:0});}var query=_url.default.parse(redirectUrl,true).query;var code=query.code,resultState=query.state,error=query.error;if(error){throw new _authError.default({json:query,status:0});}if(resultState!==expectedState){throw new _authError.default({json:{error:'a0.state.invalid',error_description:\"Invalid state received in redirect url\"},status:0});}return client.exchange({code:code,verifier:verifier,redirectUri:redirectUri}).then(function(credentials){return(0,_jwt.default)(credentials.idToken,{domain:domain,clientId:clientId,nonce:parameters.nonce,maxAge:parameters.max_age,scope:parameters.scope,leeway:options.leeway}).then(function(){return Promise.resolve(credentials);});});});});}},{key:\"clearSession\",value:function clearSession(){var options=arguments.length>0&&arguments[0]!==undefined?arguments[0]:{};var client=this.client,agent=this.agent,domain=this.domain,clientId=this.clientId;options.clientId=clientId;options.returnTo=callbackUri(domain);options.federated=options.federated||false;var logoutUrl=client.logoutUrl(options);return agent.show(logoutUrl,false,true);}}]);return WebAuth;}();exports.default=WebAuth;","map":{"version":3,"sources":["/Users/diannamcallister/Desktop/spotstitch/frontend/node_modules/react-native-auth0/src/webauth/index.js"],"names":["A0Auth0","NativeModules","callbackUri","domain","bundleIdentifier","lowerCasedIdentifier","toLowerCase","console","warn","Platform","OS","WebAuth","auth","client","baseUrl","clientId","agent","Agent","parameters","options","newTransaction","then","state","verifier","defaults","redirectUri","expectedState","query","responseType","authorizeUrl","show","ephemeralSession","redirectUrl","startsWith","AuthError","json","error","error_description","status","url","parse","code","resultState","exchange","credentials","idToken","nonce","maxAge","max_age","scope","leeway","Promise","resolve","returnTo","federated","logoutUrl"],"mappings":"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","sourcesContent":["import Agent from './agent';\nimport {NativeModules, Platform} from 'react-native';\n\nimport url from 'url';\nimport AuthError from '../auth/authError';\nimport verifyToken from '../jwt';\n\nconst {A0Auth0} = NativeModules;\n\nconst callbackUri = domain => {\n  const bundleIdentifier = A0Auth0.bundleIdentifier;\n  const lowerCasedIdentifier = bundleIdentifier.toLowerCase();\n  if (bundleIdentifier !== lowerCasedIdentifier) {\n    console.warn(\n      'The Bundle Identifier or Application ID of your app contains uppercase characters and will be lowercased to build the Callback URL. Check the Auth0 dashboard to whitelist the right URL value.',\n    );\n  }\n  return `${lowerCasedIdentifier}://${domain}/${Platform.OS}/${bundleIdentifier}/callback`;\n};\n\n/**\n * Helper to perform Auth against Auth0 hosted login page\n *\n * It will use `/authorize` endpoint of the Authorization Server (AS)\n * with Code Grant and Proof Key for Challenge Exchange (PKCE).\n *\n * @export\n * @class WebAuth\n * @see https://auth0.com/docs/api-auth/grant/authorization-code-pkce\n */\nexport default class WebAuth {\n  constructor(auth) {\n    this.client = auth;\n    const {baseUrl, clientId, domain} = auth;\n    this.domain = domain;\n    this.clientId = clientId;\n    this.agent = new Agent();\n  }\n\n  /**\n   * Starts the AuthN/AuthZ transaction against the AS in the in-app browser.\n   *\n   * In iOS it will use `SFSafariViewController` and in Android Chrome Custom Tabs.\n   *\n   * To learn more about how to customize the authorize call, check the Universal Login Page\n   * article at https://auth0.com/docs/hosted-pages/login\n   *\n   * @param {Object}  parameters Parameters to send on the AuthN/AuthZ request.\n   * @param {String}  [parameters.state] Random string to prevent CSRF attacks and used to discard unexepcted results. By default its a cryptographically secure random.\n   * @param {String}  [parameters.nonce] Random string to prevent replay attacks of id_tokens.\n   * @param {String}  [parameters.audience] Identifier of Resource Server (RS) to be included as audience (aud claim) of the issued access token\n   * @param {String}  [parameters.scope] Scopes requested for the issued tokens. e.g. `openid profile`\n   * @param {String}  [parameters.connection] The name of the identity provider to use, e.g. \"google-oauth2\" or \"facebook\". When not set, it will display Auth0's Universal Login Page.\n   * @param {Number}  [parameters.max_age] The allowable elapsed time in seconds since the last time the user was authenticated (optional).\n   * @param {Object}  options Other configuration options.\n   * @param {Number}  [options.leeway] The amount of leeway, in seconds, to accommodate potential clock skew when validating an ID token's claims. Defaults to 60 seconds if not specified.\n   * @param {Boolean} [options.ephemeralSession] Disable Single-Sign-On (SSO). It only affects iOS with versions 13 and above.\n   * @returns {Promise}\n   * @see https://auth0.com/docs/api/authentication#authorize-client\n   *\n   * @memberof WebAuth\n   */\n  authorize(parameters = {}, options = {}) {\n    const {clientId, domain, client, agent} = this;\n    return agent.newTransaction().then(({state, verifier, ...defaults}) => {\n      const redirectUri = callbackUri(domain);\n      const expectedState = parameters.state || state;\n      let query = {\n        ...defaults,\n        clientId,\n        responseType: 'code',\n        redirectUri,\n        state: expectedState,\n        ...parameters,\n      };\n      const authorizeUrl = this.client.authorizeUrl(query);\n      return agent\n        .show(authorizeUrl, options.ephemeralSession)\n        .then(redirectUrl => {\n          if (!redirectUrl || !redirectUrl.startsWith(redirectUri)) {\n            throw new AuthError({\n              json: {\n                error: 'a0.redirect_uri.not_expected',\n                error_description: `Expected ${redirectUri} but got ${redirectUrl}`,\n              },\n              status: 0,\n            });\n          }\n          const query = url.parse(redirectUrl, true).query;\n          const {code, state: resultState, error} = query;\n          if (error) {\n            throw new AuthError({json: query, status: 0});\n          }\n          if (resultState !== expectedState) {\n            throw new AuthError({\n              json: {\n                error: 'a0.state.invalid',\n                error_description: `Invalid state received in redirect url`,\n              },\n              status: 0,\n            });\n          }\n\n          return client\n            .exchange({code, verifier, redirectUri})\n            .then(credentials => {\n              return verifyToken(credentials.idToken, {\n                domain,\n                clientId,\n                nonce: parameters.nonce,\n                maxAge: parameters.max_age,\n                scope: parameters.scope,\n                leeway: options.leeway,\n              }).then(() => Promise.resolve(credentials));\n            });\n        });\n    });\n  }\n\n  /**\n   *  Removes Auth0 session and optionally remove the Identity Provider session.\n   *\n   *  In iOS it will use `SFSafariViewController` and in Android Chrome Custom Tabs.\n   *\n   * @param {Object} parameters Parameters to send\n   * @param {Bool} [parameters.federated] Optionally remove the IdP session.\n   * @returns {Promise}\n   * @see https://auth0.com/docs/logout\n   *\n   * @memberof WebAuth\n   */\n  clearSession(options = {}) {\n    const {client, agent, domain, clientId} = this;\n    options.clientId = clientId;\n    options.returnTo = callbackUri(domain);\n    options.federated = options.federated || false;\n    const logoutUrl = client.logoutUrl(options);\n    return agent.show(logoutUrl, false, true);\n  }\n}\n"]},"metadata":{},"sourceType":"script"}